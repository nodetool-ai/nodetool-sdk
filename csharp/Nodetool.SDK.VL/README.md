# Nodetool.SDK.VL

VL/vvvv integration layer for `Nodetool.SDK`.

This package focuses on:

- a shared connection to a NodeTool server (WebSocket worker + HTTP discovery)
- dynamically generated VL nodes for workflow execution

## Installation

Add a reference to the NuGet package:

```xml
<PackageReference Include="Nodetool.SDK.VL" Version="0.1.1" />
```

## Usage (overview)

### vvvv gamma: how to reference this

In **vvvv gamma**, you typically reference either:

- the `Nodetool.SDK.VL.csproj` **directly** (recommended while developing), or
- the built `Nodetool.SDK.VL.dll` (and its dependencies) directly.

In both cases: **reference `Nodetool.SDK.VL` only**. Don’t reference `Nodetool.SDK` separately unless you really know why.

**Important (vvvv gamma limitation):** vvvv gamma does not reliably follow **project-to-project** references (`<ProjectReference .../>`) inside a referenced `.csproj`.
If you reference `Nodetool.SDK.VL.csproj` and hit type-load issues, prefer referencing the built DLLs directly, or add the dependent projects as separate dependencies too:

- `csharp/Nodetool.Types/Nodetool.Types.csproj`
- `csharp/Nodetool.SDK/Nodetool.SDK.csproj`
- `csharp/Nodetool.SDK.VL/Nodetool.SDK.VL.csproj`

**Recommended (most reliable for dev in this repo):** reference the built DLLs from the stable folder:

- `csharp/_vvvv_builds/Release/net8.0/Nodetool.SDK.VL.dll`
- `csharp/_vvvv_builds/Release/net8.0/Nodetool.SDK.dll`
- `csharp/_vvvv_builds/Release/net8.0/Nodetool.Types.dll`

### 1) Make sure you referenced the right thing

All DLL files from:

- `nodetool-sdk/csharp/_vvvv_builds/Release/net8.0/`

### 2) Find the Connect node

In the node browser, look under:

- **`Nodetool` → `Connect`**

This node creates a shared connection used by all Nodetool VL nodes.

**Local default:**

- BaseUrl (worker WS): `ws://localhost:7777/ws` (or `ws://localhost:7777`)
- ApiKey: optional (depends on your server config)

### 3) Where are the workflow nodes?

Workflow nodes are generated by querying the server API (`GET /api/workflows/`).

Look under:

- **`Nodetool Workflows`** (plus a diagnostic node `WorkflowAPIStatus` in the same category)

If you see **no workflows**, place `WorkflowAPIStatus` and check its `Status` / `ProcessingSummary` outputs.

#### Workflow outputs

- **Images**: workflow outputs inferred as images are exposed as **`SkiaSharp.SKImage`** pins (VL can preview them).
- **Text/unknown**: outputs default to **`string`** pins (readable + avoids `Object` warnings).
- **Debug**: every workflow node has a **`Debug`** output pin with the last ~30 runner updates.

### 4) Where are the “normal” node nodes?

Node nodes are generated from server metadata (`GET /api/nodes/metadata`).

Look under categories like:

- **`Nodetool Nodes.*`** (plus `NodesAPIStatus`)

#### Node outputs

Every node has:

- `IsRunning` / `Error`
- **`Debug`**: last ~30 runner updates (progress/node_update/output_update).

### 5) Image helper nodes

Look under:

- **`Nodetool` → `DecodeImageRef`** (extract encoded bytes from an ImageRef JSON/wrapper)
- **`Nodetool.Images` → `DecodeImageRefToSKImage`** (decode to `SKImage`)

### Important note about URLs

The VL layer derives the HTTP API base URL from the worker URL (ws/wss → http/https), so you typically only need to set **Connect → BaseUrl**.

### Local defaults

Typical local NodeTool endpoints:

- Worker WS: `ws://localhost:7777/ws`
- HTTP API: `http://localhost:7777`

The VL layer derives the HTTP base URL from the worker URL automatically.
