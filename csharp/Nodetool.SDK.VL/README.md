# Nodetool.SDK.VL

VL/vvvv integration layer for `Nodetool.SDK`.

This package focuses on:

- a shared connection to a NodeTool server (WebSocket worker + HTTP discovery)
- dynamically generated VL nodes for workflow execution

## Installation

Add a reference to the NuGet package:

```xml
<PackageReference Include="Nodetool.SDK.VL" Version="0.1.1" />
```

## Usage (overview)

### vvvv gamma: how to reference this

In **vvvv gamma**, you typically reference either:

- the `Nodetool.SDK.VL.csproj` **directly** (recommended while developing), or
- the built `Nodetool.SDK.VL.dll` (and its dependencies) directly.

In both cases: **reference `Nodetool.SDK.VL` only**. Don’t reference `Nodetool.SDK` separately unless you really know why.

**Important (vvvv gamma limitation):** vvvv gamma does not reliably follow **project-to-project** references (`<ProjectReference .../>`) inside a referenced `.csproj`.
If you reference `Nodetool.SDK.VL.csproj` and hit type-load issues, prefer referencing the built DLLs directly, or add the dependent projects as separate dependencies too:

- `csharp/Nodetool.Types/Nodetool.Types.csproj`
- `csharp/Nodetool.SDK/Nodetool.SDK.csproj`
- `csharp/Nodetool.SDK.VL/Nodetool.SDK.VL.csproj`

**Recommended (most reliable):** reference this DLL directly:

- `csharp/Nodetool.SDK.VL/bin/Release/net8.0/Nodetool.SDK.VL.dll`

…and keep these DLLs next to it (same folder), so .NET can resolve dependencies:

- `Nodetool.SDK.dll`
- `Nodetool.Types.dll`

### 1) Make sure you referenced the right thing

If you only reference **`Nodetool.SDK`** (the plain .NET library), VL will show lots of imported C# types — but you **won’t** get the dynamic VL nodes like **Connect** or the generated workflow nodes.

You must reference **`Nodetool.SDK.VL`** (the VL integration assembly / NuGet).

### If you see `ReflectionTypeLoadException` in vvvv

If vvvv logs an error like:

> Could not load type `Nodetool.SDK.Execution.IExecutionSession` from assembly `Nodetool.SDK ...`

then vvvv is loading a **stale or conflicting** `Nodetool.SDK.dll` that doesn’t match the `Nodetool.SDK.VL` you built.

This commonly happens because:

- **.NET won’t unload assemblies in-process**: if `Nodetool.SDK` was already loaded once (by another reference or previous compile), the new one won’t replace it until you restart vvvv gamma.
- there are **multiple copies** of `Nodetool.SDK.dll` on disk (NuGet cache, old build output folders, etc.), and vvvv resolves the wrong one first.

Fix:

- Ensure `Nodetool.SDK.VL.dll`, `Nodetool.SDK.dll`, and `Nodetool.Types.dll` come from the **same build**.
- **Restart vvvv gamma** (important: this clears already-loaded assemblies).
- Remove older copies of these packages from the NuGet global cache (optional but helps):

  - `%USERPROFILE%\.nuget\packages\nodetool.sdk\`
  - `%USERPROFILE%\.nuget\packages\nodetool.sdk.vl\`
  - `%USERPROFILE%\.nuget\packages\nodetool.types\`

- Also clear vvvv gamma’s NuGet cache (if you installed via NuGet inside vvvv gamma):
  - `%LOCALAPPDATA%\vvvv\gamma\nugets\`

### 2) Find the Connect node

In the node browser, look under:

- **`Nodetool` → `Connect`**

This node creates a shared connection used by all Nodetool VL nodes.

**Local default:**

- BaseUrl (worker WS): `ws://localhost:7777/ws` (or `ws://localhost:7777`)
- ApiKey: optional (depends on your server config)

### 3) Where are the workflow nodes?

Workflow nodes are generated by querying the server API (`GET /api/workflows/`).

Look under:

- **`Nodetool Workflows`** (plus a diagnostic node `WorkflowAPIStatus` in the same category)

If you see **no workflows**, place `WorkflowAPIStatus` and check its `Status` / `ProcessingSummary` outputs.

### 4) Where are the “normal” node nodes?

Node nodes are generated from server metadata (`GET /api/nodes/metadata`).

Look under categories like:

- **`Nodetool Nodes.*`** (plus `NodesAPIStatus`)

### Important note about URLs

The VL layer derives the HTTP API base URL from the worker URL (ws/wss → http/https), so you typically only need to set **Connect → BaseUrl**.

### Local defaults

Typical local NodeTool endpoints:

- Worker WS: `ws://localhost:7777/ws`
- HTTP API: `http://localhost:7777`

The VL layer derives the HTTP base URL from the worker URL automatically.
